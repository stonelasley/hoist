<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Email - Hoist</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8fafc; color: #1e293b; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .container { max-width: 420px; width: 100%; padding: 32px; text-align: center; }
        h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .subtitle { color: #64748b; margin-bottom: 32px; }
        .status { padding: 16px; border-radius: 8px; margin-bottom: 24px; }
        .status.loading { background: #f1f5f9; color: #475569; }
        .status.success { background: #f0fdf4; color: #166534; }
        .status.error { background: #fef2f2; color: #991b1b; }
        .btn { display: inline-block; padding: 12px 32px; border-radius: 8px; font-size: 16px; font-weight: 600; text-decoration: none; cursor: pointer; border: none; }
        .btn-primary { background: #0ea5e9; color: #fff; }
        .btn-primary:hover { background: #0284c7; }
        .spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid #cbd5e1; border-top-color: #0ea5e9; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 8px; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hoist</h1>
        <p class="subtitle">Email Verification</p>

        <div id="loading" class="status loading">
            <span class="spinner"></span> Verifying your email...
        </div>

        <div id="success" class="status success hidden">
            Your email has been verified successfully!
        </div>

        <div id="error" class="status error hidden">
            <span id="error-message">Verification failed. The link may be invalid or expired.</span>
        </div>

        <a id="open-app" href="hoist://verify-email" class="btn btn-primary hidden">Open Hoist App</a>
    </div>

    <script>
        (async function() {
            const params = new URLSearchParams(window.location.search);
            const userId = params.get('userId');
            const token = params.get('token');

            const loading = document.getElementById('loading');
            const success = document.getElementById('success');
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('error-message');
            const openApp = document.getElementById('open-app');

            if (!userId || !token) {
                loading.classList.add('hidden');
                error.classList.remove('hidden');
                errorMessage.textContent = 'Invalid verification link. Missing required parameters.';
                return;
            }

            openApp.href = 'hoist://verify-email?userId=' + encodeURIComponent(userId) + '&token=' + encodeURIComponent(token);

            try {
                const response = await fetch('/api/users/verify-email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, token })
                });

                loading.classList.add('hidden');

                if (response.ok) {
                    success.classList.remove('hidden');
                    openApp.classList.remove('hidden');
                } else {
                    error.classList.remove('hidden');
                    const data = await response.json().catch(() => null);
                    if (data?.message) {
                        errorMessage.textContent = data.message;
                    }
                }
            } catch {
                loading.classList.add('hidden');
                error.classList.remove('hidden');
                errorMessage.textContent = 'Unable to verify email. Please try again later.';
            }
        })();
    </script>
</body>
</html>
